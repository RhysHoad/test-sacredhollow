<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
    <title>Sacred Hollow Content Manager</title>
</head>
<body>
    <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js?v=999"></script>
    
    <script>
        // 2. EXPLICIT AND IMMEDIATE CONFIGURATION EXECUTION
        if(typeof CMS !== 'undefined'){
            
            // A. Forcefully unregister the conflicting Netlify Identity backend 
            // This is the CRITICAL line that bypasses the cached logic.
            CMS.unregisterBackend('netlify-identity');

            // B. Register the Preview Assets (Styles/Scripts for the iframe)
            CMS.registerPreviewStyle("assets/css/main.css");
            
            // Register all critical JS files for the preview iframe
            CMS.registerPreviewScript("assets/js/jquery.min.js");
            CMS.registerPreviewScript("assets/js/jquery.scrollex.min.js");
            CMS.registerPreviewScript("assets/js/jquery.scrolly.min.js");
            CMS.registerPreviewScript("assets/js/browser.min.js");
            CMS.registerPreviewScript("assets/js/breakpoints.min.js");
            CMS.registerPreviewScript("assets/js/util.js");
            CMS.registerPreviewScript("assets/js/main.js");
            
            // C. Manually call CMS.init() to load the admin/config.yml.
            // This is done here to guarantee order of execution.
            CMS.init();

        } else {
            console.error("Fatal: CMS object is undefined.");
        }
    </script>
    
    <script src="cms-logic.js"></script>
</body>
</html>